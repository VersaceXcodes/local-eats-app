asyncapi: 2.0.0
info:
  title: Local Eats Realtime Events API
  version: 1.0.0
  description: >
    AsyncAPI specification for realtime event-driven features of the Local Eats
    application.

    Covers order tracking, notifications, cart sync, badges, discounts, reviews,
    and restaurant status updates.
servers:
  development:
    url: ws://localhost:3000
    protocol: ws
    description: Development WebSocket server
channels:
  user/{user_id}/orders/{order_id}/status:
    description: Real-time order status updates for a specific order
    parameters:
      user_id:
        description: Unique identifier of the user who placed the order
        schema:
          type: string
      order_id:
        description: Unique identifier of the order being tracked
        schema:
          type: string
    subscribe:
      operationId: subscribeOrderStatus
      summary: Subscribe to real-time status updates for a specific order
      message:
        $ref: "#/components/messages/OrderStatusUpdate"
  user/{user_id}/notifications:
    description: Real-time notifications stream for a specific user
    parameters:
      user_id:
        description: Unique identifier of the user receiving notifications
        schema:
          type: string
    subscribe:
      operationId: subscribeUserNotifications
      summary: Subscribe to all real-time notifications for the user
      message:
        oneOf:
          - $ref: "#/components/messages/OrderNotification"
          - $ref: "#/components/messages/PromotionalNotification"
          - $ref: "#/components/messages/BadgeEarnedNotification"
          - $ref: "#/components/messages/ReviewResponseNotification"
          - $ref: "#/components/messages/DiscountNotification"
          - $ref: "#/components/messages/WeeklyPicksNotification"
  user/{user_id}/cart/sync:
    description: Real-time cart synchronization across devices/sessions
    parameters:
      user_id:
        description: Unique identifier of the user whose cart is being synced
        schema:
          type: string
    subscribe:
      operationId: subscribeCartSync
      summary: Subscribe to real-time cart state updates
      message:
        $ref: "#/components/messages/CartSyncUpdate"
  user/{user_id}/badges/earned:
    description: Real-time badge achievement notifications
    parameters:
      user_id:
        description: Unique identifier of the user earning badges
        schema:
          type: string
    subscribe:
      operationId: subscribeBadgeEarned
      summary: Subscribe to badge earned events
      message:
        $ref: "#/components/messages/BadgeEarned"
  user/{user_id}/favorites/sync:
    description: Real-time favorites list synchronization
    parameters:
      user_id:
        description: Unique identifier of the user whose favorites are syncing
        schema:
          type: string
    subscribe:
      operationId: subscribeFavoritesSync
      summary: Subscribe to favorites list updates
      message:
        $ref: "#/components/messages/FavoritesSyncUpdate"
  restaurant/{restaurant_id}/status:
    description: Real-time restaurant availability and operational status updates
    parameters:
      restaurant_id:
        description: Unique identifier of the restaurant
        schema:
          type: string
    subscribe:
      operationId: subscribeRestaurantStatus
      summary: Subscribe to restaurant status changes (open/closed, online/offline)
      message:
        $ref: "#/components/messages/RestaurantStatusUpdate"
  restaurant/{restaurant_id}/reviews/new:
    description: Real-time new review posted events for a restaurant
    parameters:
      restaurant_id:
        description: Unique identifier of the restaurant receiving reviews
        schema:
          type: string
    subscribe:
      operationId: subscribeNewReviews
      summary: Subscribe to new review events
      message:
        $ref: "#/components/messages/NewReviewPosted"
  restaurant/{restaurant_id}/discounts/new:
    description: Real-time new discount availability events
    parameters:
      restaurant_id:
        description: Unique identifier of the restaurant offering discounts
        schema:
          type: string
    subscribe:
      operationId: subscribeNewDiscounts
      summary: Subscribe to new discount events
      message:
        $ref: "#/components/messages/NewDiscountAvailable"
  restaurant/{restaurant_id}/menu/updates:
    description: Real-time menu item availability updates
    parameters:
      restaurant_id:
        description: Unique identifier of the restaurant
        schema:
          type: string
    subscribe:
      operationId: subscribeMenuUpdates
      summary: Subscribe to menu item availability changes
      message:
        $ref: "#/components/messages/MenuItemUpdate"
  global/weekly-picks:
    description: Real-time weekly local picks publication events
    subscribe:
      operationId: subscribeWeeklyPicks
      summary: Subscribe to weekly picks updates
      message:
        $ref: "#/components/messages/WeeklyPicksUpdate"
  user/{user_id}/recommendations/refresh:
    description: Real-time personalized recommendations refresh
    parameters:
      user_id:
        description: Unique identifier of the user
        schema:
          type: string
    subscribe:
      operationId: subscribeRecommendationsRefresh
      summary: Subscribe to recommendations refresh events
      message:
        $ref: "#/components/messages/RecommendationsRefresh"
components:
  messages:
    OrderStatusUpdate:
      name: OrderStatusUpdate
      title: Order Status Update Event
      summary: Sent when an order status changes
      contentType: application/json
      payload:
        $ref: "#/components/schemas/OrderStatusUpdatePayload"
    OrderNotification:
      name: OrderNotification
      title: Order-related Notification
      summary: Notification about order updates
      contentType: application/json
      payload:
        $ref: "#/components/schemas/OrderNotificationPayload"
    PromotionalNotification:
      name: PromotionalNotification
      title: Promotional Notification
      summary: Notification about promotions and special offers
      contentType: application/json
      payload:
        $ref: "#/components/schemas/PromotionalNotificationPayload"
    BadgeEarnedNotification:
      name: BadgeEarnedNotification
      title: Badge Earned Notification
      summary: Notification when user earns a badge
      contentType: application/json
      payload:
        $ref: "#/components/schemas/BadgeEarnedNotificationPayload"
    ReviewResponseNotification:
      name: ReviewResponseNotification
      title: Review Response Notification
      summary: Notification about review interactions
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ReviewResponseNotificationPayload"
    DiscountNotification:
      name: DiscountNotification
      title: Discount Notification
      summary: Notification about new discounts at favorited restaurants
      contentType: application/json
      payload:
        $ref: "#/components/schemas/DiscountNotificationPayload"
    WeeklyPicksNotification:
      name: WeeklyPicksNotification
      title: Weekly Picks Notification
      summary: Notification when weekly picks are published
      contentType: application/json
      payload:
        $ref: "#/components/schemas/WeeklyPicksNotificationPayload"
    CartSyncUpdate:
      name: CartSyncUpdate
      title: Cart Synchronization Update
      summary: Full cart state synchronization event
      contentType: application/json
      payload:
        $ref: "#/components/schemas/CartSyncPayload"
    BadgeEarned:
      name: BadgeEarned
      title: Badge Earned Event
      summary: Event when user earns a new badge
      contentType: application/json
      payload:
        $ref: "#/components/schemas/BadgeEarnedPayload"
    FavoritesSyncUpdate:
      name: FavoritesSyncUpdate
      title: Favorites Sync Update
      summary: Favorites list synchronization event
      contentType: application/json
      payload:
        $ref: "#/components/schemas/FavoritesSyncPayload"
    RestaurantStatusUpdate:
      name: RestaurantStatusUpdate
      title: Restaurant Status Update
      summary: Restaurant availability status change event
      contentType: application/json
      payload:
        $ref: "#/components/schemas/RestaurantStatusPayload"
    NewReviewPosted:
      name: NewReviewPosted
      title: New Review Posted Event
      summary: Event when a new review is posted for a restaurant
      contentType: application/json
      payload:
        $ref: "#/components/schemas/NewReviewPayload"
    NewDiscountAvailable:
      name: NewDiscountAvailable
      title: New Discount Available Event
      summary: Event when a new discount becomes available
      contentType: application/json
      payload:
        $ref: "#/components/schemas/NewDiscountPayload"
    MenuItemUpdate:
      name: MenuItemUpdate
      title: Menu Item Availability Update
      summary: Event when menu item availability changes
      contentType: application/json
      payload:
        $ref: "#/components/schemas/MenuItemUpdatePayload"
    WeeklyPicksUpdate:
      name: WeeklyPicksUpdate
      title: Weekly Picks Update Event
      summary: Event when new weekly picks are published
      contentType: application/json
      payload:
        $ref: "#/components/schemas/WeeklyPicksPayload"
    RecommendationsRefresh:
      name: RecommendationsRefresh
      title: Recommendations Refresh Event
      summary: Event when personalized recommendations are refreshed
      contentType: application/json
      payload:
        $ref: "#/components/schemas/RecommendationsRefreshPayload"
  schemas:
    OrderStatusUpdatePayload:
      type: object
      required:
        - event_type
        - order_id
        - user_id
        - restaurant_id
        - order_status
        - timestamp
      properties:
        event_type:
          type: string
          enum:
            - order_status_updated
        order_id:
          type: string
        user_id:
          type: string
        restaurant_id:
          type: string
        order_status:
          type: string
          enum:
            - order_received
            - preparing
            - ready
            - out_for_delivery
            - delivered
            - cancelled
        previous_status:
          type: string
          enum:
            - order_received
            - preparing
            - ready
            - out_for_delivery
            - delivered
            - cancelled
          nullable: true
        estimated_delivery_time:
          type: string
          format: date-time
          nullable: true
        estimated_pickup_time:
          type: string
          format: date-time
          nullable: true
        cancellation_reason:
          type: string
          nullable: true
        timestamp:
          type: string
          format: date-time
    OrderNotificationPayload:
      type: object
      required:
        - notification_id
        - user_id
        - notification_type
        - message
        - timestamp
        - is_read
      properties:
        notification_id:
          type: string
        user_id:
          type: string
        notification_type:
          type: string
          enum:
            - order_update
        message:
          type: string
        order_id:
          type: string
          nullable: true
        action_url:
          type: string
          nullable: true
        is_read:
          type: boolean
        timestamp:
          type: string
          format: date-time
    PromotionalNotificationPayload:
      type: object
      required:
        - notification_id
        - user_id
        - notification_type
        - message
        - timestamp
        - is_read
      properties:
        notification_id:
          type: string
        user_id:
          type: string
        notification_type:
          type: string
          enum:
            - promotion
        message:
          type: string
        restaurant_id:
          type: string
          nullable: true
        discount_id:
          type: string
          nullable: true
        action_url:
          type: string
          nullable: true
        is_read:
          type: boolean
        timestamp:
          type: string
          format: date-time
    BadgeEarnedNotificationPayload:
      type: object
      required:
        - notification_id
        - user_id
        - notification_type
        - message
        - timestamp
        - is_read
      properties:
        notification_id:
          type: string
        user_id:
          type: string
        notification_type:
          type: string
          enum:
            - badge_earned
        message:
          type: string
        badge_id:
          type: string
        badge_name:
          type: string
        badge_icon_url:
          type: string
          nullable: true
        action_url:
          type: string
          nullable: true
        is_read:
          type: boolean
        timestamp:
          type: string
          format: date-time
    ReviewResponseNotificationPayload:
      type: object
      required:
        - notification_id
        - user_id
        - notification_type
        - message
        - timestamp
        - is_read
      properties:
        notification_id:
          type: string
        user_id:
          type: string
        notification_type:
          type: string
          enum:
            - review_response
        message:
          type: string
        review_id:
          type: string
          nullable: true
        action_url:
          type: string
          nullable: true
        is_read:
          type: boolean
        timestamp:
          type: string
          format: date-time
    DiscountNotificationPayload:
      type: object
      required:
        - notification_id
        - user_id
        - notification_type
        - message
        - timestamp
        - is_read
      properties:
        notification_id:
          type: string
        user_id:
          type: string
        notification_type:
          type: string
          enum:
            - discount
        message:
          type: string
        restaurant_id:
          type: string
        restaurant_name:
          type: string
        discount_id:
          type: string
        discount_description:
          type: string
        action_url:
          type: string
          nullable: true
        is_read:
          type: boolean
        timestamp:
          type: string
          format: date-time
    WeeklyPicksNotificationPayload:
      type: object
      required:
        - notification_id
        - user_id
        - notification_type
        - message
        - timestamp
        - is_read
      properties:
        notification_id:
          type: string
        user_id:
          type: string
        notification_type:
          type: string
          enum:
            - weekly_picks
        message:
          type: string
        week_start_date:
          type: string
          format: date
        action_url:
          type: string
          nullable: true
        is_read:
          type: boolean
        timestamp:
          type: string
          format: date-time
    CartSyncPayload:
      type: object
      required:
        - user_id
        - restaurant_id
        - items
        - subtotal
        - grand_total
        - timestamp
      properties:
        user_id:
          type: string
        restaurant_id:
          type: string
          nullable: true
        restaurant_name:
          type: string
          nullable: true
        items:
          type: array
          items:
            type: object
            required:
              - menu_item_id
              - item_name
              - base_price
              - quantity
              - item_total
            properties:
              menu_item_id:
                type: string
              item_name:
                type: string
              base_price:
                type: number
              selected_size:
                type: string
                nullable: true
              size_price_adjustment:
                type: number
              selected_addons:
                type: array
                items:
                  type: object
                  required:
                    - name
                    - price
                  properties:
                    name:
                      type: string
                    price:
                      type: number
              selected_modifications:
                type: array
                items:
                  type: object
                  required:
                    - name
                    - price
                  properties:
                    name:
                      type: string
                    price:
                      type: number
              special_instructions:
                type: string
                nullable: true
              quantity:
                type: integer
                minimum: 1
              item_total:
                type: number
        order_type:
          type: string
          enum:
            - delivery
            - pickup
          nullable: true
        delivery_address:
          type: object
          nullable: true
          properties:
            street_address:
              type: string
            apartment_suite:
              type: string
              nullable: true
            city:
              type: string
            state:
              type: string
            zip_code:
              type: string
        applied_discount:
          type: object
          nullable: true
          properties:
            discount_id:
              type: string
            coupon_code:
              type: string
            discount_amount:
              type: number
            discount_type:
              type: string
        subtotal:
          type: number
        delivery_fee:
          type: number
        tax:
          type: number
        tip:
          type: number
        grand_total:
          type: number
        timestamp:
          type: string
          format: date-time
    BadgeEarnedPayload:
      type: object
      required:
        - user_badge_id
        - user_id
        - badge_id
        - badge_name
        - badge_description
        - earned_at
      properties:
        user_badge_id:
          type: string
        user_id:
          type: string
        badge_id:
          type: string
        badge_name:
          type: string
        badge_description:
          type: string
        badge_icon_url:
          type: string
          nullable: true
        criteria_type:
          type: string
        criteria_value:
          type: integer
        earned_at:
          type: string
          format: date-time
    FavoritesSyncPayload:
      type: object
      required:
        - user_id
        - action
        - timestamp
      properties:
        user_id:
          type: string
        action:
          type: string
          enum:
            - added
            - removed
        favorite_id:
          type: string
          nullable: true
        restaurant_id:
          type: string
        restaurant_name:
          type: string
          nullable: true
        restaurant_ids:
          type: array
          items:
            type: string
        timestamp:
          type: string
          format: date-time
    RestaurantStatusPayload:
      type: object
      required:
        - restaurant_id
        - is_currently_open
        - timestamp
      properties:
        restaurant_id:
          type: string
        restaurant_name:
          type: string
        is_currently_open:
          type: boolean
        next_open_time:
          type: string
          format: date-time
          nullable: true
        next_close_time:
          type: string
          format: date-time
          nullable: true
        is_active:
          type: boolean
        accepts_delivery:
          type: boolean
        accepts_pickup:
          type: boolean
        estimated_prep_time_minutes:
          type: integer
        timestamp:
          type: string
          format: date-time
    NewReviewPayload:
      type: object
      required:
        - review_id
        - restaurant_id
        - user_id
        - star_rating
        - review_text
        - created_at
      properties:
        review_id:
          type: string
        restaurant_id:
          type: string
        user_id:
          type: string
        reviewer_name:
          type: string
        reviewer_profile_picture_url:
          type: string
          nullable: true
        star_rating:
          type: integer
          minimum: 1
          maximum: 5
        review_title:
          type: string
          nullable: true
        review_text:
          type: string
        is_verified_visit:
          type: boolean
        photo_urls:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time
    NewDiscountPayload:
      type: object
      required:
        - discount_id
        - restaurant_id
        - discount_type
        - discount_value
        - description
        - start_date
        - end_date
      properties:
        discount_id:
          type: string
        restaurant_id:
          type: string
        restaurant_name:
          type: string
        discount_type:
          type: string
          enum:
            - percentage
            - fixed_amount
            - qr_discount
            - first_order
        discount_value:
          type: number
        coupon_code:
          type: string
          nullable: true
        description:
          type: string
        terms_conditions:
          type: string
          nullable: true
        minimum_order_amount:
          type: number
          nullable: true
        is_local_picks_exclusive:
          type: boolean
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
    MenuItemUpdatePayload:
      type: object
      required:
        - menu_item_id
        - restaurant_id
        - item_name
        - is_available
        - timestamp
      properties:
        menu_item_id:
          type: string
        restaurant_id:
          type: string
        item_name:
          type: string
        is_available:
          type: boolean
        base_price:
          type: number
          nullable: true
        timestamp:
          type: string
          format: date-time
    WeeklyPicksPayload:
      type: object
      required:
        - week_start_date
        - week_end_date
        - picks
        - published_at
      properties:
        week_start_date:
          type: string
          format: date
        week_end_date:
          type: string
          format: date
        picks:
          type: array
          items:
            type: object
            required:
              - pick_id
              - restaurant_id
              - restaurant_name
            properties:
              pick_id:
                type: string
              restaurant_id:
                type: string
              restaurant_name:
                type: string
              featured_description:
                type: string
                nullable: true
              primary_hero_image_url:
                type: string
                nullable: true
              cuisine_types:
                type: array
                items:
                  type: string
              average_rating:
                type: number
              price_range:
                type: integer
              display_order:
                type: integer
        published_at:
          type: string
          format: date-time
    RecommendationsRefreshPayload:
      type: object
      required:
        - user_id
        - recommendations
        - generated_at
      properties:
        user_id:
          type: string
        recommendations:
          type: array
          items:
            type: object
            required:
              - restaurant_id
              - restaurant_name
              - reason_tag
            properties:
              restaurant_id:
                type: string
              restaurant_name:
                type: string
              reason_tag:
                type: string
              primary_hero_image_url:
                type: string
                nullable: true
              cuisine_types:
                type: array
                items:
                  type: string
              average_rating:
                type: number
              price_range:
                type: integer
              distance_miles:
                type: number
                nullable: true
        generated_at:
          type: string
          format: date-time
